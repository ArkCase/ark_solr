#!/bin/bash

set -euo pipefail
. /.functions

ARTIFACT_IDS=(
	org.eclipse.jetty:jetty-http@SERVER_LIB_EXT_DIR
	org.eclipse.jetty:jetty-io@SERVER_LIB_EXT_DIR
	org.eclipse.jetty:jetty-server@SERVER_LIB_EXT_DIR
	org.eclipse.jetty:jetty-util@SERVER_LIB_EXT_DIR
	org.eclipse.jetty.http2:http2-common@SERVER_LIB_EXT_DIR
	org.eclipse.jetty.http2:http2-hpack@SERVER_LIB_EXT_DIR

	org.eclipse.jetty:jetty-alpn-java-server@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-alpn-server@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-deploy@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-jmx@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-rewrite@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-security@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-servlet@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-servlets@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-webapp@SERVER_LIB_DIR
	org.eclipse.jetty:jetty-xml@SERVER_LIB_DIR
	org.eclipse.jetty.http2:http2-server@SERVER_LIB_DIR

	org.eclipse.jetty:jetty-alpn-client@WEBAPP_LIBS_DIR
	org.eclipse.jetty:jetty-alpn-java-client@WEBAPP_LIBS_DIR
	org.eclipse.jetty:jetty-client@WEBAPP_LIBS_DIR
	org.eclipse.jetty.http2:http2-client@WEBAPP_LIBS_DIR
	org.eclipse.jetty.http2:http2-http-client-transport@WEBAPP_LIBS_DIR
)

set_or_default BASE_DIR "/app"
set_or_default HOME_DIR "${BASE_DIR}/solr"
set_or_default SERVER_DIR "${HOME_DIR}/server"
set_or_default WEBAPP_DIR "${SERVER_DIR}/solr-webapp/webapp"
set_or_default WEBAPP_LIBS_DIR "${WEBAPP_DIR}/WEB-INF/lib"
set_or_default SERVER_LIB_DIR "${SERVER_DIR}/lib"
set_or_default SERVER_LIB_EXT_DIR "${SERVER_LIB_DIR}/ext"

export WEBAPP_LIBS_DIR
export SERVER_LIB_DIR
export SERVER_LIB_EXT_DIR
export POST_CALL="fix-jar-sum"
exec fix-jars "CVE-2025-5115" "10.0.26" "${ARTIFACT_IDS[@]}"
