#!/bin/bash

set -euo pipefail
. /.functions

ARTIFACT_IDS=(
	io.grpc:grpc-api@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR
	io.grpc:grpc-context@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR
	io.grpc:grpc-core@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR
	io.grpc:grpc-protobuf@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR
	io.grpc:grpc-protobuf-lite@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR
	io.grpc:grpc-stub@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR
	io.grpc:grpc-util@GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR

	io.grpc:grpc-alts@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-auth@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-googleapis@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-grpclb@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-inprocess@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-netty@TELEMETRY_LIB_DIR
	io.grpc:grpc-netty-shaded@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-rls@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-services@GCS_REPOSITORY_LIB_DIR
	io.grpc:grpc-xds@GCS_REPOSITORY_LIB_DIR
)

set_or_default BASE_DIR "/app"
set_or_default HOME_DIR "${BASE_DIR}/solr"
set_or_default MODULES_DIR "${HOME_DIR}/modules"
set_or_default TELEMETRY_LIB_DIR "${MODULES_DIR}/opentelemetry/lib"
set_or_default GCS_REPOSITORY_LIB_DIR "${MODULES_DIR}/gcs-repository/lib"

export TELEMETRY_LIB_DIR
export GCS_REPOSITORY_LIB_DIR
export POST_CALL="fix-jar-sum"
exec fix-jars "CVE-2025-55163" "1.75.0" "${ARTIFACT_IDS[@]}"
