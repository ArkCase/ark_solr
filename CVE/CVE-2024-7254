#!/bin/bash

set -euo pipefail
. /.functions

ARTIFACT_IDS=(
	com.google.protobuf:protobuf-java@CROSS_DC_MANAGER_LIB_DIR,EXTRACTION_LIB_DIR,GCS_REPOSITORY_LIB_DIR,TELEMETRY_LIB_DIR,SQL_LIB_DIR
	com.google.protobuf:protobuf-java-util@CROSS_DC_MANAGER_LIB_DIR,GCS_REPOSITORY_LIB_DIR
)

set_or_default BASE_DIR "/app"
set_or_default HOME_DIR "${BASE_DIR}/solr"
set_or_default CROSS_DC_MANAGER_LIB_DIR "${HOME_DIR}/cross-dc-manager/lib"
set_or_default MODULES_DIR "${HOME_DIR}/modules"
set_or_default EXTRACTION_LIB_DIR "${MODULES_DIR}/extraction/lib"
set_or_default GCS_REPOSITORY_LIB_DIR "${MODULES_DIR}/gcs-repository/lib"
set_or_default TELEMETRY_LIB_DIR "${MODULES_DIR}/opentelemetry/lib"
set_or_default SQL_LIB_DIR "${MODULES_DIR}/sql/lib"

export CROSS_DC_MANAGER_LIB_DIR
export EXTRACTION_LIB_DIR
export GCS_REPOSITORY_LIB_DIR
export TELEMETRY_LIB_DIR
export SQL_LIB_DIR
export POST_CALL="fix-jar-sum"
exec fix-jars "CVE-2024-7254" "3.25.5" "${ARTIFACT_IDS[@]}"
