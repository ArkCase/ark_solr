#!/bin/bash

set -euo pipefail
. /.functions

ARTIFACT_IDS=(
	org.apache.kafka:kafka-clients@CROSS_DC_LIB_DIR

	org.apache.kafka:kafka-group-coordinator@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-group-coordinator-api@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-metadata@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-raft@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-server@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-server-common@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-storage@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-storage-api@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-streams@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-tools-api@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka-transaction-coordinator@CROSS_DC_MANAGER_LIB_DIR
	org.apache.kafka:kafka_2.13@CROSS_DC_MANAGER_LIB_DIR
)

set_or_default BASE_DIR "/app"
set_or_default HOME_DIR "${BASE_DIR}/solr"
set_or_default CROSS_DC_MANAGER_LIB_DIR "${HOME_DIR}/cross-dc-manager/lib"
set_or_default MODULES_DIR "${HOME_DIR}/modules"
set_or_default CROSS_DC_LIB_DIR "${MODULES_DIR}/cross-dc/lib"

export CROSS_DC_LIB_DIR
export CROSS_DC_MANAGER_LIB_DIR
export POST_CALL="fix-jar-sum"
exec fix-jars "CVE-2025-27817" "3.9.1" "${ARTIFACT_IDS[@]}"
